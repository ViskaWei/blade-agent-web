# Student Paper Pipeline — Low Cognitive Load v1.0
# 4 colors (process/gate/data/error), 4 shapes, ~20 nodes, single vertical spine

direction: down

# ── Classes ──────────────────────────────────────────────────

classes: {
  process: {
    style.fill: "#DBEAFE"
    style.stroke: "#2563EB"
    style.stroke-width: 2
    style.border-radius: 8
  }
  gate: {
    shape: diamond
    style.fill: "#FEF3C7"
    style.stroke: "#D97706"
    style.stroke-width: 2
  }
  data-io: {
    shape: parallelogram
    style.fill: "#F1F5F9"
    style.stroke: "#64748B"
    style.stroke-width: 2
  }
  rework: {
    style.fill: "#FFE4E6"
    style.stroke: "#E11D48"
    style.stroke-width: 2
    style.stroke-dash: 4
    style.border-radius: 8
  }
  terminal: {
    shape: oval
    style.fill: "#DBEAFE"
    style.stroke: "#2563EB"
    style.stroke-width: 2
  }
}

# ── Happy-path spine (top → bottom) ─────────────────────────

input: "goal.md\n(ARXIV + TOPIC + DEPTH)" { class: data-io }

start: Start { class: terminal }

ingest: "Ingest Paper\nfetch → parse → index" { class: process }

triage: "Triage (LLM)\ntriage.json" { class: process }

map: "Map Structure (LLM)\nmap.md + glossary" { class: process }

q1: "Q1 Gate\nmap complete?" { class: gate }

depth: "Depth Route?" { class: gate }

mechanics: "Analyze Mechanics (LLM)\nclaims + methods + skeptic" { class: process }

q2: "Q2 Gate\ntraceable?" { class: gate }

mastery: "Build Mastery (LLM)\nteachback + quiz + repro" { class: process }

q3: "Q3 Gate\ncan explain?" { class: gate }

package: "Package Output (LLM)\nSTART_HERE.md" { class: process }

pkg_gate: "Pkg Gate\ntimestamps? citations?" { class: gate }

verify: "Verify Output\nstudent_ok.sh" { class: process }

done: Done { class: terminal }

output: "START_HERE.md" { class: data-io }

# ── Rework nodes (side, dashed rose) ────────────────────────

rework_map: "Rework Map\n(max 2x)" { class: rework }
rework_mech: "Rework Mechanics\n(max 2x)" { class: rework }
rework_mastery: "Rework Mastery\n(max 2x)" { class: rework }
rework_pkg: "Rework Package\n(max 2x)" { class: rework }

# ── Happy-path edges (solid blue) ───────────────────────────

input -> start: {
  style.stroke: "#2563EB"
  style.stroke-width: 2
}
start -> ingest: {
  style.stroke: "#2563EB"
  style.stroke-width: 2
}
ingest -> triage: {
  style.stroke: "#2563EB"
  style.stroke-width: 2
}
triage -> map: {
  style.stroke: "#2563EB"
  style.stroke-width: 2
}
map -> q1: {
  style.stroke: "#2563EB"
  style.stroke-width: 2
}
q1 -> depth: pass {
  style.stroke: "#2563EB"
  style.stroke-width: 2
}
depth -> mechanics: "L1+ deep analysis" {
  style.stroke: "#2563EB"
  style.stroke-width: 2
}
mechanics -> q2: {
  style.stroke: "#2563EB"
  style.stroke-width: 2
}
q2 -> mastery: "pass (L2)" {
  style.stroke: "#2563EB"
  style.stroke-width: 2
}
mastery -> q3: {
  style.stroke: "#2563EB"
  style.stroke-width: 2
}
q3 -> package: pass {
  style.stroke: "#2563EB"
  style.stroke-width: 2
}
package -> pkg_gate: {
  style.stroke: "#2563EB"
  style.stroke-width: 2
}
pkg_gate -> verify: pass {
  style.stroke: "#2563EB"
  style.stroke-width: 2
}
verify -> done: {
  style.stroke: "#2563EB"
  style.stroke-width: 2
}
done -> output: {
  style.stroke: "#2563EB"
  style.stroke-width: 2
}

# ── Depth skip edges (slate, thinner) ───────────────────────

depth -> package: "L0 skip" {
  style.stroke: "#64748B"
  style.stroke-width: 1
}
q2 -> package: "L1 skip mastery" {
  style.stroke: "#64748B"
  style.stroke-width: 1
}

# ── Gate fail → rework edges (dashed rose) ──────────────────

q1 -> rework_map: fail {
  style.stroke: "#E11D48"
  style.stroke-width: 2
  style.stroke-dash: 4
}
rework_map -> map: retry {
  style.stroke: "#E11D48"
  style.stroke-width: 1
  style.stroke-dash: 4
}

q2 -> rework_mech: fail {
  style.stroke: "#E11D48"
  style.stroke-width: 2
  style.stroke-dash: 4
}
rework_mech -> mechanics: retry {
  style.stroke: "#E11D48"
  style.stroke-width: 1
  style.stroke-dash: 4
}

q3 -> rework_mastery: fail {
  style.stroke: "#E11D48"
  style.stroke-width: 2
  style.stroke-dash: 4
}
rework_mastery -> mastery: retry {
  style.stroke: "#E11D48"
  style.stroke-width: 1
  style.stroke-dash: 4
}

pkg_gate -> rework_pkg: fail {
  style.stroke: "#E11D48"
  style.stroke-width: 2
  style.stroke-dash: 4
}
rework_pkg -> package: retry {
  style.stroke: "#E11D48"
  style.stroke-width: 1
  style.stroke-dash: 4
}
